

<script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />

<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
	
  </style>

<div id="map"></div>



<script>

	mapboxgl.accessToken = 'pk.eyJ1IjoiYWd1aWxhZGVzY2FsemEiLCJhIjoiY2xkMjQwMGV1MDRzNDN1b3oxYnJ5eThkeCJ9.nNOZYvXs_8dHoUW8w0DeOQ';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-71.104081, 42.365554],
        zoom: 14
    });

	var marker = new mapboxgl.Marker().setLngLat([-71.092761, 42.357575]).addTo(map);

async function run(){
    // get bus data    
	const locations = await getBusLocations();
	marker.setLngLat([Number(locations[0].attributes.longitude), Number(locations[0].attributes.latitude)]);
	//console.log(new Date());
	//console.log(locations)
	//console.log(locations[0].attributes.latitude);
	console.log(locations[0].attributes.current_stop_sequence);
	//drawOnMap(locations);
	// timer
	setTimeout(run, 15000);
}

// Request bus data from MBTA
async function getBusLocations(){
	const url = 'https://api-v3.mbta.com/vehicles?filter[route]=1&include=trip';
	const response = await fetch(url);
	const json     = await response.json();
	return json.data;
}


run();

</script>